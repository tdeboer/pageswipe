$(function(){var c,b,g,k,l,i,e,m,a,d=false,n=false,h=false,j=false,f=false;$.widget("custom.swipeable",{swipeStart:{},swipeStop:{},curPos:0,options:{selector:".page",navSelector:"nav",scrollSupressionThreshold:20,swipeThreshold:0.25,verticalDistanceThreshold:5,load:true},_create:function(){var o=this.element;k=this;l=o.children(".page").first();i=o.children(".page").first().next(".page");e=o.children(".page").first().prev(".page");a=$(this.options.navSelector);g=$(".header").outerHeight();k.windowResized();o.children(".page").each(function(){var s=$(this);if(k.options.load&&s.is(":empty")){s.data("content",false)}s.css("min-height",b);var r=$("<a></a>");var q=s.attr("id");r.attr("href","#"+q);r.attr("alt",q);r.attr("class",q);r.text(s.attr("data-title"));a.append(r)});l.addClass("current").data("content",true);a.find("a:first").addClass("selected");if(Modernizr.touch){o.children(".page:gt(0)").each(function(){$(this).css("top",g)});if(this.options.load){var p=i.attr("data-url");i.load(p,function(){$(this).data("content",true).css("z-index",1)})}else{$(this).data("content",true)}o.find(this.options.selector).last().addClass("last");this._on({touchstart:"_touchStart",touchmove:"_touchMove",touchend:"_touchEnd"});$(window).bind({scrollstop:this._scrollStop,resize:this.windowResized})}else{if(this.options.load){o.children(".page:gt(0)").each(function(){k._loadPage($(this),function(){$(this).data("content",true)})})}else{$(this).data("content",true)}$("nav a, .btn-about").on({click:this._gotoPage});$(window).bind({scrollstop:this._updateNav})}},_touchStart:function(o){o.stopImmediatePropagation();if(!d){var p=o.originalEvent.touches[0];this.swipeStart={coords:[p.pageX,p.pageY]}}},_touchMove:function(q){if(!d&&!h){q.stopImmediatePropagation();var p=this.swipeStart.coords[0]-q.originalEvent.touches[0].pageX;var o=this.swipeStart.coords[1]-q.originalEvent.touches[0].pageY;if(j||Math.abs(p)>this.options.scrollSupressionThreshold){q.preventDefault();l.css({x:0-p});if(!j){if(p>this.options.scrollSupressionThreshold/2){if(l.hasClass("last")){$(".shutter").css("z-index",5)}else{i.css("z-index",5);$(".shutter").css("z-index",0)}}else{if(p<((this.options.scrollSupressionThreshold/2)*-1)){if(l.hasClass("first")){$(".shutter").css("z-index",5)}else{e.css("z-index",5);$(".shutter").css("z-index",0)}}}}j=true}else{if(Math.abs(o)>=5){h=true}}}},_touchEnd:function(q){if(j&&!d){k._log("swiped:true");var t=this.swipeStart,o=q.originalEvent.changedTouches[0],s=t.coords[0]-o.pageX,p=this.element,r=$(document).scrollTop()>g;j=false;h=false;d=true;if(Math.abs(s)>(c*this.options.swipeThreshold)){k._log("enough swipe");if(s>0&&i.length){k._log("swipe next");l.transition({x:-1*c},function(){d=false;var u=g-$(document).scrollTop();if(r){$(document).scrollTop(g);u=0}i.css({position:"relative",top:"auto","z-index":"10"});l.css({position:"fixed",top:u,"z-index":"0"});a.find("a.selected").removeClass("selected").next().addClass("selected");e=l;l=l.next(".page");i=i.next(".page");i.css({x:"0"});e.css({x:"0"});e.removeClass("current");l.addClass("current");if(k.options.load){k.loadNeighbours()}})}else{if(s<0&&e.length){k._log("swipe prev");l.transition({x:c},function(){d=false;var u=g-$(document).scrollTop();if(r){$(document).scrollTop(g);u=0}e.css({position:"relative",top:"auto","z-index":"10"});l.css({position:"fixed",top:u,"z-index":"0"});a.find("a.selected").removeClass("selected").prev().addClass("selected");i=l;l=l.prev(".page");e=e.prev(".page");i.css({x:"0"});e.css({x:"0"});i.removeClass("current");l.addClass("current");if(k.options.load){k.loadNeighbours()}})}else{k._log("no page available");this.bounceBack()}}}else{k._log("not enough swipe");this.bounceBack()}}},_gotoPage:function(o){o.stopImmediatePropagation();o.preventDefault();$(".header .selected").removeClass("selected");$(this).addClass("selected");var p=$(this).attr("href");var q=$(p);$.scrollTo(q,1400,{onAfter:function(){window.location.hash=p}})},_loadPage:function(p,q){var o=p.attr("data-url");p.load(o,q)},_updateNav:function(){$(".header .selected").removeClass("selected");var o;$(".page, .special-page").each(function(){if($(document).scrollTop()>=$(this).offset().top){o=$(this).attr("id")}});$(".header").find("."+o).addClass("selected")},bounceBack:function(){l.transition({x:0},function(){d=false;e.add(i).css("z-index",0)})},loadNeighbours:function(){if(!i.data("content")&&typeof i.attr("data-url")!=="undefined"){this._loadPage(i,function(){$(this).data("content",true).css("z-index",1)})}if(!e.data("content")&&typeof e.attr("data-url")!=="undefined"){this._loadPage(e,function(){$(this).data("content",true).css("z-index",1)})}},_scrollStop:function(o){h=false;if(!f&&$(document).scrollTop()>g){$(".page:not(.current)").each(function(){$(this).css("top",0)});f=true}else{if($(document).scrollTop()<g){$(".page:not(.current)").each(function(){$(this).css("top",g-$(document).scrollTop())});f=false}}},windowResized:function(){c=$(window).width();b=$(window).height()},_log:function(o){if(n){console.log(o)}}})});