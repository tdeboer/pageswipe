$(function(){var c,b,m,g,j,k=false,e=false,l,h,d,n,a,o=false,i=false,f=false;$.widget("custom.swipeable",{swipeStart:{},swipeStop:{},pos:null,preventScroll:false,curPos:0,options:{selector:".page",navSelector:"nav",scrollSupressionThreshold:20,swipeThreshold:0.25,verticalDistanceThreshold:5,swipeBoundry:40,disableSwipe:false,scrolling:false,timer:null,load:true},_create:function(){var p=this.element;j=this;l=p.children(".page").first();h=p.children(".page").first().next(".page");d=p.children(".page").first().prev(".page");a=$(this.options.navSelector);g=$(".header").outerHeight();j.windowResized();p.children(".page").each(function(){var t=$(this);if(j.options.load&&t.is(":empty")){t.data("content",false)}t.css("min-height",b);var s=$("<a></a>");var r=t.attr("id");s.attr("href","#"+r);s.attr("alt",r);s.attr("class",r);s.text(t.attr("data-title"));a.append(s)});l.addClass("current").data("content",true);a.find("a:first").addClass("selected");if(Modernizr.touch){p.children(".page:gt(0)").each(function(){$(this).css("top",g)});if(this.options.load){var q=h.attr("data-url");h.load(q,function(){$(this).data("content",true).css("z-index",1)})}else{$(this).data("content",true)}p.find(this.options.selector).last().addClass("last");this._on({touchstart:"_touchStart",touchmove:"_touchMove",touchend:"_touchEnd",scrollstart:"_scrollStart"});$(window).bind({scrollstop:this._scrollStop,resize:this.windowResized})}else{if(this.options.load){p.children(".page:gt(0)").each(function(){j._loadPage($(this),function(){$(this).data("content",true)})})}else{$(this).data("content",true)}$("nav a, .btn-about").on({click:this._gotoPage})}},_touchStart:function(p){p.stopImmediatePropagation();if(!e){var q=p.originalEvent.touches[0];this.swipeStart={coords:[q.pageX,q.pageY]}}},_touchMove:function(r){if(!e&&!k){r.stopImmediatePropagation();var q=this.swipeStart.coords[0]-r.originalEvent.touches[0].pageX;var p=this.swipeStart.coords[1]-r.originalEvent.touches[0].pageY;if(i||Math.abs(q)>this.options.scrollSupressionThreshold){r.preventDefault();l.css({x:0-q});if(!i){if(q>this.options.scrollSupressionThreshold/2){if(l.hasClass("last")){$(".shutter").css("z-index",5)}else{h.css("z-index",5);$(".shutter").css("z-index",0)}}else{if(q<((this.options.scrollSupressionThreshold/2)*-1)){if(l.hasClass("first")){$(".shutter").css("z-index",5)}else{d.css("z-index",5);$(".shutter").css("z-index",0)}}}}i=true}else{if(Math.abs(p)>=5){k=true}}}},_touchEnd:function(r){if(i&&!e){j._log("swiped:true");var u=this.swipeStart,p=r.originalEvent.changedTouches[0],t=u.coords[0]-p.pageX,q=this.element,s=$(document).scrollTop()>g;i=false;k=false;e=true;if(Math.abs(t)>(c*this.options.swipeThreshold)){j._log("enough swipe");if(t>0&&h.length){j._log("swipe next");l.transition({x:-1*c},function(){e=false;var v=g-$(document).scrollTop();if(s){$(document).scrollTop(g);v=0}h.css({position:"relative",top:"auto","z-index":"10"});l.css({position:"fixed",top:v,"z-index":"0"});a.find("a.selected").removeClass("selected").next().addClass("selected");d=l;l=l.next(".page");h=h.next(".page");h.css({x:"0"});d.css({x:"0"});d.removeClass("current");l.addClass("current");if(j.options.load){j.loadNeighbours()}})}else{if(t<0&&d.length){j._log("swipe prev");l.transition({x:c},function(){e=false;var v=g-$(document).scrollTop();if(s){$(document).scrollTop(g);v=0}d.css({position:"relative",top:"auto","z-index":"10"});l.css({position:"fixed",top:v,"z-index":"0"});a.find("a.selected").removeClass("selected").prev().addClass("selected");h=l;l=l.prev(".page");d=d.prev(".page");h.css({x:"0"});d.css({x:"0"});h.removeClass("current");l.addClass("current");if(j.options.load){j.loadNeighbours()}})}else{j._log("no page available");this.bounceBack()}}}else{j._log("not enough swipe");this.bounceBack()}}},_gotoPage:function(p){$(".header .selected").removeClass("selected");$(this).addClass("selected")},_loadPage:function(q,r){var p=q.attr("data-url");q.load(p,r)},showPage:function(p){l.hide();p.show().css({position:"relative",top:"auto","z-index":"10","min-height":b});past=l;l=p},bounceBack:function(){l.transition({x:0},function(){e=false;d.add(h).css("z-index",0)})},loadNeighbours:function(){if(!h.data("content")&&typeof h.attr("data-url")!=="undefined"){this._loadPage(h,function(){$(this).data("content",true).css("z-index",1)})}if(!d.data("content")&&typeof d.attr("data-url")!=="undefined"){this._loadPage(d,function(){$(this).data("content",true).css("z-index",1)})}},_scrollStart:function(p){},_scrollStop:function(p){k=false;if(!f&&$(document).scrollTop()>g){$(".page:not(.current)").each(function(){$(this).css("top",0)});f=true}else{if($(document).scrollTop()<g){$(".page:not(.current)").each(function(){$(this).css("top",g-$(document).scrollTop())});f=false}}},_sticky:function(){$el=$("nav");if($("fixed-nav").not(":visible")&&$(document).scrollTop()>=g){$("fixed-nav").show()}else{if($("fixed-nav").is(":visible")&&$(document).scrollTop()<g){$("fixed-nav").hide()}}},windowResized:function(){c=$(window).width();b=$(window).height()},_log:function(p){if(o){console.log(p)}}})});